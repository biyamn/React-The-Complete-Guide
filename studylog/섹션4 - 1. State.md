
#### 💡 리액트 State에 관한 포스팅을 작성했다.
👉 <a href='https://velog.io/@hamham/%EB%A6%AC%EC%95%A1%ED%8A%B8%EC%97%90%EC%84%9C-state%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%98%EB%8A%94-%EC%9D%B4%EC%9C%A0'>[리액트] state를 사용하는 이유</a>

---

# State란?

- 자료를 잠깐 저장할 때 씀(변수처럼)
    
    [https://codingapple.com/unit/react-3-state-usestate-hook/](https://codingapple.com/unit/react-3-state-usestate-hook/)
    
- 리액트에서 앱의 유동적인 데이터를 다루기 위해 있는 객체
- 일반적으로 리액트에서는 유동적인 데이터는 변수에 담아서 사용하지 않고 useState()라는 리액트 함수를 사용하여 state라는 저장공간에 담아 사용한다.

# State를 사용하는 이유는?

- State는 변경되면 자동으로 재렌더링된다.
- 변수는 변경되어도 자동 재렌더링이 안됨!

# State vs. 일반 변수

변경되는 값을 일반 변수로 만들었을 때의 문제점을 알아보자. 

아래 코드는 `props.title`을 `itemTitle`이라는 변수에 저장하고, 버튼이 클릭되면 `itemTitle`을 ‘Updated!’라는 문자열로 변경하는 함수 `clickHandler`를 실행한다. 

```
const ExpenseItem = (props) => {

  let title = props.title;

  const clickHandler = () => {
    title = 'Updated!';
    console.log('title updated') // title updated
  }
  return (
    <Card className="expense-item">
      <ExpenseDate date={props.date} />
      <div className="expense-item__description">
        <h2>{title}</h2>
        <div className="expense-item__price">
          ₩{props.amount.toLocaleString()}
        </div>
      </div>
      <button onClick={clickHandler}>Change Title</button>
    </Card>
  );
}

export default ExpenseItem;
```

그래서 버튼을 눌러봤다. 하지만 itemTitle이 기존 문자열에서 변하지 않는다. 그렇다고 `clickHandler` 함수가 실행되지 않는 것은 아니다. 콘솔창에 가보면 'title updated'라는 문자열이 출력된다. 그렇다면 뭐가 문제일까? 바로 state가 아닌 일반 변수를 사용하였기 때문이다. 일반 변수는 값이 변경된다고 화면에서 해당하는 부분이 다시 그려지지 않는다. 이 문제를 해결하는 state란 무엇인지 앞으로 자세히 살펴보자.

> 참고
> 

이 문제를 해결하려면 아래와 같이 state를 사용하면 된다.

```jsx
**import { useState } from 'react';**

const ExpenseItem = (props) => {

  **const [title, setTitle] = useState(props.title);

  const clickHandler = () => {
    setTitle('Updated!');
    console.log('updated');
  }**

  return (
    <Card className="expense-item">
      <ExpenseDate date={props.date} />
      <div className="expense-item__description">
        **<h2>{title}</h2>**
        <div className="expense-item__price">
          ₩{props.amount.toLocaleString()}
        </div>
      </div>
      **<button onClick={clickHandler}>Change Title</button>**
    </Card>
  );
}
```

# State 사용 방법은?

```jsx
import { useState } from 'react';

const [state, setState] = useState();

setState(state);
```

1. import { useState }
2. const [state, setState] = useState(초기값)
- useState를 사용해서 상태를 등록하면 항상 두 개의 값을 얻는데 이는 현재 상태값과 업데이트하는 함수이다. (중요!!!!!)
- state 선언 시 const를 사용하는 이유
    - **setState를 사용한 변수 변경만을 허락하기 위해서** const로 선언한다.
    - let을 사용하면 state = 100과 같은 변수 형식의 할당이 가능해진다.
    - 하지만 const로 선언하면 변수 형태의 재할당을 막을 수 있다.
1. state를 업데이트 할 때 `setState(state)`로 업데이트 할 수 있다. 

# State의 동작 원리는?

- React 라이브러리에 있는 useState()함수를 통해 state를 사용할 수 있다.
- useState()를 실행시키면 초기값으로 설정해 놓은 state를 기억하고 있다.
- setState를 통해 state의 값이 변경되면 변경된 state 값에 맞춰 재렌더링하게 된다.
- 즉, **state가 업데이트되면 재실행된다. state가 업데이트되면 컴포넌트 자체를 다시 불러오게 된다. →  컴포넌트가 재실행될 때마다 항상 가장 최신 상태의 화면을 갖는다**

# ****State는 여러 가지 방법으로 업데이트 될 수 있다****

- 지금까지는 유저 이벤트(클릭과 같은) 발생 시 상태를 업그레이드했다. 이는 일반적이지만, 상태 업데이트에 꼭 필요한 것은 아니다.
- 어떤 이유로든 상태를 업데이트할 수 있다!
    - 예) 타이머가 만료됐을 때 상태를 업데이트할 수 있다(`setTimeout()`)

# State의 범위

**컴포넌트별로 독립적인 state를 갖는다.**

(한 요소에서 어떤 것을 변경했는데 다른 요소도 업데이트된다면 안 될 것이다)

# State에 대한 질문과 답변

> 아래는 state에 대해 잘 이해하지 못했을 때 올린 질문과 그에 대한 답변이다. 이해해 많은 도움이 되어 나중에도 참고하기 위해 첨부했다.
> 

## 질문

```jsx
리액트 State에 관한 질문입니다! 

아래의 사진처럼 + 버튼을 누르면 숫자가 증가하고 - 버튼을 누르면 숫자가 감소하는 
Counter 예제를 만들어보았는데요.

아래의 코드처럼 State를 쓰면 화면에서 count가 증가/감소하며 변화하는데
import './Counter.css';
import { useState } from 'react';
const Counter = () => {
  const [count, setCount] = useState(0);
  const plus = () => {
    setCount(count + 1);
  }
  const minus = () => {
    setCount(count - 1);
  }
  return (
    <div className='container'>
      <h2 className='int'>{ count }</h2>
      <button className='plus' onClick={plus}>+</button>
      <button className='minus' onClick={minus}>-</button>
    </div>
  )
}

export default Counter;

아래의 코드처럼 State를 안쓰고 그냥 변수를 사용하면 아무리 + 버튼이나 - 버튼을 눌러도 
count가 변하지 않습니다...

import './Counter.css';

const Counter = () => {
  let count = 0;
  const plus = () => {
    count = count + 1
    console.log(count); // 제대로 증가함
  }
  const minus = () => {
    count = count - 1
    console.log(count); // 제대로 감소함
  }

  return (
    <div className='container'>
      <h2 className='int'>{ count }</h2>
      <button className='plus' onClick={plus}>+</button>
      <button className='minus' onClick={minus}>-</button>
    </div>
  )
}

export default Counter;

근데 console.log로 찍어서 확인해보면 count는 변화하거든요?? 
근데 화면에는 변화한 값이 출력되지 않더라고요...!!!

왜 이런지 궁금합니다 ,, 
리액트에서 State를 쓰는 이유가 이거랑 연관되어 있을 것 같은데 잘 모르겠어요...!
```

## 답변

```markdown
연관된 게 맞아요
리액트를 비롯해서
리액티브한 프런트엔드에서 상태는
단순히 변수가 아니고
이 값이 변했을 때 화면에 반영되도록
연결되어 있는 걸 상태라 합니다
그래서 상태가 아닌 그냥 변수는 바꿔도 화면이 변하지 않고
더 신기한 거는
setCount 아래에 console.log를 찍으면
값이 변하지 않았을 겁니다
그 이유는
setCount는 비동기이기 때문인데
값을 직접 바꾸는 게 아니라
리액트에게 상태를 바꾸고 함수를 다시 실행해서 렌더링을 해달라는
요청을 보내는 거라
setCount를 호출하면
아직 요청을 보내기만(dispatch)한 상태라
이벤트 핸들러가 끝나고
리액트가 상태를 바꾸고 화면을 다시 그리기를 기다려야 합니다.
인간에게는 찰나의 시간이지만요
어쨌든 그래서 그냥 변수가 아니라 useState를 써야 하는 것이지요. (설명 끝)
```

(동기/비동기 설명: [https://velog.io/@slobber/동기와-비동기의-차이](https://velog.io/@slobber/%EB%8F%99%EA%B8%B0%EC%99%80-%EB%B9%84%EB%8F%99%EA%B8%B0%EC%9D%98-%EC%B0%A8%EC%9D%B4))

## 질문

```markdown
그럼 그냥 변수를 쓰는데 변수가 변할 때마다 화면이 재렌더되는 코드를 짠다면 
그게 useState의 기능이랑 동일한 건가요? 
그냥 변수랑 useState가 다른 점이 화면을 다시 그린다는 것밖에 없는 건가요?
```

## 답변

```markdown
그게 뭐 사실은 리액트 내부 구조는 매우 복잡하긴 한데
순수 자바스크립트로 리액트 비슷하게 만들 때
말씀하신 것 같은 구독 반응형 상태 같은 걸 만들어요
생각보다 쉽게 만들 수 있어요. 16줄 이내로?
입사할 때 과제로도 많이 낸답니다
```

## 질문

이것도 구독 반응형 상태를 만든 건가요...?(해석: 리액트처럼 되기 위해 자바스크립트가 구독 반응형 상태를 만든 것이냐)

```html
<html>
<head>
</head>
<body>
  <div id="container">
    <button id="plus">숫자증가</button>
		<button id="minus">숫자감소</button>
    <span>0</span>
  </div>
</body>
</html>
```

```jsx
const plusBtn = container.querySelector('#plus');
const minusBtn = container.querySelector('#minus');
const number = container.querySelector('span');

plusBtn.addEventListener('click',function(){
   let count = Number(number.textContent)
    count = count + 1;
    number.textContent = count;
});
minusBtn.addEventListener('click',function(){
   let count = Number(number.textContent)
    count = count - 1;
    number.textContent = count;
});
```

## 답변

```html
아뇨
이거는 명령형의 전형적인 예시인데
보면 count 값을 바꿀 때마다
수동으로 textContent의 값을
count랑 같게 동기화 시켜주고 있지요.
그러면
어떻게 하면 되느냐
```

```jsx
const plusBtn = container.querySelector('#plus');
const minusBtn = container.querySelector('#minus');
const number = container.querySelector('span');

let count = 0;
function setCount(newValue){
   count = newValue;
   number.textContent = count;
} 

plusBtn.addEventListener('click',function(){
    setCount(count + 1);
});
minusBtn.addEventListener('click',function(){
    setCount(count - 1);
});
```

```jsx
이러면
리액티브입니다.
setCount라는 함수로 count를 변경하면
화면에 바꾸는 일도 알아서 해주고
count 변수의 값이랑 화면이 동기화 되지요.
(여기서 더 나아가면 observable이라고 구독할 수 있는 것도 만들고 하는데. 일단 생략...)
```

## 질문

```jsx
앗 조금 이해안가는 부분이 있는데, setCount라는 함수로 count를 변경하면
화면에 바꾸는 일을 알아서 해준다고 하셨는데 그건 어떻게 알 수 있나요???"
```

## 답변

```jsx
저 number.textContent = count
하는 부분이
HTML에 있는 span의 textContent를
count 값으로 바꿔주는 건데
명령형에서는 그걸 매번 해주지만
반응형에서는 상태를 바꿀 때 항상 같이 일어나게 해요
그래서 setCount를 쓰면
상태 값도 바뀌고 그 값에 맞게 화면도 바뀌는 거죠
```